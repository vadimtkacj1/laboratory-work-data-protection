# Лабораторна робота №6: SQL-ін'єкції

## Опис

Ця лабораторна робота демонструє уразливість до SQL-ін'єкцій та методи захисту від них. Реалізовано систему пошуку студентів з двома версіями: вразливою та захищеною.

## Функціональність

### Реалізовані функції

1. **Вразлива версія**
   - Пряме підставлення користувацького вводу в SQL-запит
   - Демонстрація успішних SQL-ін'єкцій
   - Витік даних через зловмисні запити

2. **Захищена версія**
   - Використання параметризованих запитів (prepared statements)
   - Захист від SQL-ін'єкцій
   - Безпечна обробка користувацького вводу

3. **База даних**
   - SQLite база даних з інформацією про студентів
   - Автоматична ініціалізація тестових даних

## Структура проекту

```
lab06/
├── app.py              # Flask додаток з вразливою та захищеною версіями
├── templates/
│   └── index.html      # Головна сторінка з інтерфейсом
├── static/
│   ├── style.css       # Стилізація
│   └── script.js       # JavaScript логіка
├── students.db         # SQLite база даних (створюється автоматично)
├── requirements.txt     # Залежності Python
└── README.md           # Документація
```

## Як використовувати

### Вимоги

- Python 3.7+
- Flask (встановлюється через requirements.txt)

### Встановлення

1. Встановіть залежності:
```bash
pip install -r requirements.txt
```

2. Запустіть додаток:
```bash
python app.py
```

3. Відкрийте браузер і перейдіть на:
```
http://localhost:5000
```

**Приклад з нашого застосунку:**

**Вразливий код:**
```python
query = f"SELECT * FROM students WHERE name LIKE '%{search_query}%'"
cursor.execute(query)
```

**Захищений код:**
```python
query = "SELECT * FROM students WHERE name LIKE ?"
params = (f'%{search_query}%',)
cursor.execute(query, params)
```

### 1. Обхід автентифікації / Виведення всіх записів

**Введіть у поле пошуку:**
```
' OR '1'='1
```

**Що відбувається:**
- SQL запит стає: `SELECT * FROM students WHERE name LIKE '%' OR '1'='1%'`
- Умова `'1'='1'` завжди істинна
- Виводяться всі записи з таблиці

### 2. UNION атака

**Введіть у поле пошуку:**
```
' UNION SELECT * FROM students--
```

**Що відбувається:**
- `--` коментує решту запиту
- UNION об'єднує результати з іншими запитами
- Може використовуватися для витягування даних з інших таблиць

### 3. Коментарі для обходу

**Введіть у поле пошуку:**
```
'--
```

**Що відбувається:**
- Коментує решту SQL-запиту після введеного тексту
- Дозволяє обійти перевірки

### 4. Подвійні лапки

**Введіть у поле пошуку:**
```
" OR "1"="1
```

**Що відбувається:**
- Альтернативний варіант обходу з подвійними лапками
- Працює якщо система використовує подвійні лапки

## Порівняння вразливої та захищеної версій

### Вразлива версія

**Код:**
```python
query = f"SELECT * FROM students WHERE name LIKE '%{search_query}%' OR email LIKE '%{search_query}%'"
cursor.execute(query)
```

**Проблеми:**
- Пряме підставлення користувацького вводу в SQL-запит
- Немає валідації або екранування
- Дозволяє виконати довільний SQL-код

**Результат при атаці `' OR '1'='1`:**
- Виконується запит: `SELECT * FROM students WHERE name LIKE '%' OR '1'='1%' OR email LIKE '%' OR '1'='1%'`
- Виводяться всі записи з таблиці

### Захищена версія

**Код:**
```python
query = "SELECT * FROM students WHERE name LIKE ? OR email LIKE ?"
params = (f'%{search_query}%', f'%{search_query}%')
cursor.execute(query, params)
```

**Переваги:**
- Використання параметризованих запитів (prepared statements)
- Параметри передаються окремо від запиту
- База даних автоматично екранує спеціальні символи
- Неможливо виконати довільний SQL-код

**Результат при атаці `' OR '1'='1`:**
- Параметр обробляється як звичайний текст
- Шукається буквально рядок `' OR '1'='1`
- Не знаходиться жодного запису (якщо такого імені немає)

## Технічні деталі

### Використані технології

- **Python 3.7+** - мова програмування
- **Flask** - веб-фреймворк
- **SQLite** - база даних
- **HTML/CSS/JavaScript** - фронтенд

### Структура бази даних

```sql
CREATE TABLE students (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT NOT NULL,
    group_name TEXT NOT NULL,
    birth_date TEXT NOT NULL,
    phone TEXT,
    address TEXT
)
```

### Тестові дані

База даних автоматично ініціалізується з 6 тестовими записами:
- Vadim Tkachenko
- Ivan Petrenko
- Maria Kovalenko
- Oleksandr Shevchenko
- Anna Melnyk
- Admin User

## Демонстрація роботи

### Сценарій 1: Нормальний пошук

1. Введіть: `Vadim`
2. Обидві версії знайдуть студента "Vadim Tkachenko"
3. Результати однакові

### Сценарій 2: SQL-ін'єкція на вразливій версії

1. Введіть у вразливу версію: `' OR '1'='1`
2. Виводяться всі студенти з бази даних
3. SQL-запит показує виконану ін'єкцію

### Сценарій 3: SQL-ін'єкція на захищеній версії

1. Введіть у захищену версію: `' OR '1'='1`
2. Не знаходиться жодного запису
3. Параметри показують, що введений текст обробляється як звичайний рядок

## Висновки

### Що було досягнуто

1. ✅ Створено вразливий застосунок з SQL-ін'єкціями
2. ✅ Реалізовано захищену версію з параметризованими запитами
3. ✅ Продемонстровано різницю між вразливою та захищеною версіями
4. ✅ Створено зручний веб-інтерфейс для тестування

### Ключові висновки

- **Параметризовані запити** - найефективніший спосіб захисту від SQL-ін'єкцій
- **Валідація вводу** - важлива, але не достатня для повного захисту
- **Логування** - допомагає виявляти спроби атак
- **Принцип найменших привілеїв** - база даних має мати мінімальні права

## Рекомендації для захисту

1. **Завжди використовуйте параметризовані запити**
   - Prepared statements автоматично екранують спеціальні символи
   - Неможливо виконати довільний SQL-код

2. **Валідація вводу**
   - Перевіряйте формат даних
   - Обмежуйте довжину вводу
   - Використовуйте whitelist замість blacklist

3. **Принцип найменших привілеїв**
   - База даних має мати мінімальні необхідні права
   - Не використовуйте обліковий запис з правами адміністратора

4. **Логування та моніторинг**
   - Логуйте всі SQL-запити
   - Відстежуйте підозрілу активність
   - Налаштуйте сповіщення про спроби атак

5. **Регулярні оновлення**
   - Оновлюйте базу даних та фреймворки
   - Використовуйте останні версії бібліотек

## Діагностика проблем

### Помилка при запуску

- Перевірте, що Python встановлений: `python --version`
- Встановіть залежності: `pip install -r requirements.txt`
- Перевірте, що порт 5000 вільний

### База даних не створюється

- Перевірте права доступу до директорії
- Переконайтеся, що SQLite встановлений
- Перевірте логи в консолі

### SQL-ін'єкції не працюють на вразливій версії

- Перевірте, що використовується вразлива версія
- Переконайтеся, що введено правильний синтаксис
- Перевірте логи сервера

## Автор

Лабораторна робота виконана в рамках курсу "Кібербезпека"

## Ліцензія

Навчальний проект

